if [ ! -z $1 ]
then
  export AWKNAME=$1
else
  export AWKNAME=awk
fi

rm -r artifacts/builds/$AWKNAME
set -xe
source common.sh

mkdir artifacts/builds/$AWKNAME
$AWKNAME -v my_fname="artifacts/deps/cjsawk_full.c" -v my_fout="artifacts/builds/$AWKNAME/cjsawk_awk.exe.M1" -v use_fast_or=1 -v use_fast_and=1 -f cjsawk.js -f support.awk -f cjsawk_test.awk
# artifacts/builds/$AWKNAME/cjsawk_awk.exe.M1

cd artifacts/builds/$AWKNAME
assemble_link cjsawk_awk.exe

compile ./cjsawk_awk.exe ../../deps/cjsawk_full.c boot0.exe
compile ./boot0.exe ../../deps/cjsawk_full.c boot1.exe
compile ./boot1.exe ../../deps/cjsawk_full.c cjsawk.exe

echo "DONE $1"
