./mk_tcc pnut.list
set -xe
cp artifacts/pnut_js.exe ../artifacts/pnut-exe

for i in $(find ../tcc-0.9.26-lb/ -type f); do
echo load_file $i $i
done > artifacts/full.list

for i in $(find ../mes-0.27/ -type f); do
echo load_file $i $i
done >> artifacts/full.list

pushd .
cd ../pnut_refactor/

for i in $(find portable_libc -type f); do
echo load_file ../pnut_refactor/$i $i
done >> ../xp_linux/artifacts/full.list

popd

# hack shouldn't be necessary but something odd seems to be happening with
# includes

pushd .
cd ../mes-0.27/include/

for i in $(find mes -type f); do
echo load_file ../mes-0.27/include/$i ../artifacts/boot0/$i
done >> ../../xp_linux/artifacts/full.list

popd

# hack as we don't yet have a catm that can handle a directory prefix
echo "load_file ../artifacts/boot0/unified-libc.c ../artifacts/boot0/unified-libc.c" >> artifacts/full.list

cat tcc_boot_mes.list >> artifacts/full.list

./artifacts/test_tracer.exe ./artifacts/test_tracee.exe artifacts/full.list

sha256sum -c ../sums_tcc-boot-mes

echo "DONE full"
