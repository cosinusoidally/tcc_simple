rm artifacts/min_win32_asm*

set -xe

chmod +x artifacts/hex2.exe
chmod +x artifacts/m0.exe

./artifacts/m0.exe min_win32_ref.M1 artifacts/min_win32_asm.hex2

# dummy argument is a hack to tell hex2.exe to change its base address
./artifacts/hex2.exe artifacts/min_win32_asm.hex2 artifacts/min_win32_asm1.exe artifacts/dummy

# 2nd dummy argument is a hack to tell hex2.exe to change its base address
./artifacts/hex2.exe artifacts/min_win32_asm.hex2 artifacts/min_win32_asm2.exe artifacts/dummy artifacts/dummy2

head -c 5632 artifacts/min_win32_asm2.exe > artifacts/min_win32_asm_head.exe
tail -c 5120 artifacts/min_win32_asm_head.exe > artifacts/min_win32_asm_text.exe
head -c 512 artifacts/min_win32_asm1.exe > artifacts/min_win32_asm_header.exe
tail -c 1024 artifacts/min_win32_asm1.exe > artifacts/min_win32_asm_data.exe

cat artifacts/min_win32_asm_header.exe artifacts/min_win32_asm_text.exe artifacts/min_win32_asm_data.exe > artifacts/min_win32_asm.exe

xxd artifacts/min_win32_asm.exe artifacts/min_win32_asm.exe.hexdump
xxd artifacts/min_win32.exe artifacts/min_win32.exe.hexdump

ls -l artifacts/min_win32*exe
diff -u -s artifacts/min_win32_asm.exe.hexdump artifacts/min_win32.exe.hexdump
