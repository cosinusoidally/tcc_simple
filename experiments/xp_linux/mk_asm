set -xe

chmod +x artifacts/hex2.exe
chmod +x artifacts/m0.exe

./artifacts/m0.exe min_win32_text.M1 artifacts/min_win32_text.hex2
./artifacts/m0.exe min_win32_data.M1 artifacts/min_win32_data.hex2

cat min_win32_head.hex2 artifacts/min_win32_text.hex2 artifacts/min_win32_data.hex2 > artifacts/min_win32.hex2

# dummy argument is a hack to tell hex2.exe to change its base address
./artifacts/hex2.exe artifacts/min_win32.hex2 artifacts/min_win32_asm1.exe artifacts/dummy

# 2nd dummy argument is a hack to tell hex2.exe to change its base address
./artifacts/hex2.exe artifacts/min_win32.hex2 artifacts/min_win32_asm2.exe artifacts/dummy artifacts/dummy2

head -c 5632 artifacts/min_win32_asm2.exe > artifacts/min_win32_asm_head.exe
tail -c 1024 artifacts/min_win32_asm1.exe > artifacts/min_win32_asm_tail.exe

cat artifacts/min_win32_asm_head.exe artifacts/min_win32_asm_tail.exe > artifacts/min_win32_asm.exe

xxd artifacts/min_win32_asm.exe artifacts/min_win32_asm.exe.hexdump
xxd artifacts/min_win32.exe artifacts/min_win32.exe.hexdump

ls -l artifacts/min_win32*exe
wc min_win32_text.*
diff -u -s artifacts/min_win32_asm.exe.hexdump artifacts/min_win32.exe.hexdump
